{% extends 'base.html' %}
{% load static %}

{% block title %}VineBot{% endblock %}

{% block content %}
<div class="h-screen w-full flex bg-[#131314] text-gray-200 font-sans">

    <div id="sidebar" class="w-64 bg-[#1e1f20] flex flex-col p-2 transition-transform duration-300 ease-in-out -translate-x-full sm:translate-x-0">
        <div class="p-2 mb-4">
            <button onclick="toggleSidebar()" class="p-2 rounded-full hover:bg-gray-700">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                </svg>
            </button>
        </div>

        <div class="mb-4 space-y-2">
            <button class="w-full flex items-center justify-between bg-blue-500 text-white py-2 px-4 rounded-full text-sm font-semibold hover:bg-blue-600">
                <span><i class="fa-solid fa-star"></i> Rate Us</span>
            </button>
            <button class="w-full flex items-center justify-between bg-blue-500 text-white py-2 px-4 rounded-full text-sm font-semibold hover:bg-blue-600">
                <span>+ New Chat</span>
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.5L14.732 3.732z" />
                </svg>
            </button>
            
        </div>

        <div class="flex-1 overflow-y-auto">
            <p class="text-xs text-gray-400 font-semibold px-2 mb-2">Recent</p>
            <ul id="chat-list" class="space-y-1 text-sm">
                <li class="p-2 rounded-lg hover:bg-gray-700 cursor-pointer truncate">Welcome to VineBot Chat</li>
                <li class="p-2 rounded-lg hover:bg-gray-700 cursor-pointer truncate">Understanding the Book of Genesis</li>
            </ul>
        </div>

        <div class="p-2 border-t border-gray-700">
            <a href="{% url 'logout' %}" class="w-full flex items-center gap-2 p-2 rounded-lg hover:bg-gray-700">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 bg-gray-600 rounded-full p-1" viewBox="0 0 20 20" fill="currentColor">
                  <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd" />
                </svg>
                <span class="text-sm">Logout</span>
            </a>
        </div>
    </div>

    <div class="flex-1 flex flex-col h-screen">
        <div class="flex justify-between items-center p-4 bg-[#131314] text-lg">
            <div class="flex items-center gap-2">
                <button onclick="toggleSidebar()" class="p-2 rounded-full hover:bg-gray-700 sm:hidden">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                    </svg>
                </button>
                <span class="font-semibold">VineBot</span>
            </div>
            </div>
        
        <div id="chat-container" class="flex-1 overflow-y-auto">
            <div class="max-w-3xl mx-auto px-4 py-8">
                
                <div id="welcome-screen" class="text-center">
                    <div class="text-5xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-blue-400 to-purple-500 mb-4">
                        Hello, I'm VineBot
                    </div>
                    <img src="{% static 'images/vinebotLogo.png' %}" alt="logo" class="mx-auto w-20 h-15">
                    <p class="text-2xl text-gray-400">How can I help you today?</p>
                </div>

                <div id="chat-box" class="space-y-8">
                    </div>
            </div>
        </div>

        <div class="px-4 pb-4">
            <div class="max-w-3xl mx-auto">
                <form id="chat-form" class="relative">
                    <textarea id="chat-input" placeholder="Enter a prompt here"
                           class="w-full bg-[#1e1f20] border border-gray-700 rounded-2xl p-4 pr-14 text-gray-200 resize-none focus:outline-none focus:ring-2 focus:ring-blue-500"
                           rows="1" oninput="autoGrow(this)"></textarea>
                    <button type="submit" class="absolute right-3 top-1/2 -translate-y-1/2 p-2 rounded-full bg-gray-700 hover:bg-blue-500 disabled:bg-gray-800" disabled>
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18" />
                        </svg>
                    </button>
                </form>
                <p class="text-xs text-center text-gray-500 mt-2">
                    VineBot may display inaccurate info, so double-check its responses.
                </p>
            </div>
        </div>
    </div>
</div>

<script>
    const sidebar = document.getElementById("sidebar");
    const chatForm = document.getElementById("chat-form");
    const chatInput = document.getElementById("chat-input");
    const chatBox = document.getElementById("chat-box");
    const welcomeScreen = document.getElementById("welcome-screen");
    const submitButton = chatForm.querySelector('button[type="submit"]');

    // Function to toggle the sidebar
    function toggleSidebar() {
        sidebar.classList.toggle("-translate-x-full");
    }

    // Enable/disable send button based on input
    chatInput.addEventListener('input', () => {
        if (chatInput.value.trim() !== '') {
            submitButton.disabled = false;
            submitButton.classList.remove('disabled:bg-gray-800');
            submitButton.classList.add('bg-blue-500');
            submitButton.classList.remove('bg-gray-700');
        } else {
            submitButton.disabled = true;
            submitButton.classList.add('disabled:bg-gray-800');
            submitButton.classList.remove('bg-blue-500');
            submitButton.classList.add('bg-gray-700');
        }
    });

    // Auto-grow textarea
    function autoGrow(element) {
        element.style.height = "5px";
        element.style.height = (element.scrollHeight) + "px";
    }

    // Handle form submission
    chatForm.addEventListener("submit", function (e) {
        e.preventDefault();
        const message = chatInput.value.trim();
        if (message === "") return;

        // Hide welcome screen on first message
        if (!welcomeScreen.classList.contains('hidden')) {
            welcomeScreen.classList.add('hidden');
        }

        // Display user message
        const userMessageEl = document.createElement("div");
        userMessageEl.className = "flex items-start gap-4";
        userMessageEl.innerHTML = `
            <div class="w-8 h-8 rounded-full bg-gray-600 flex items-center justify-center font-bold text-sm">U</div>
            <div class="flex-1 pt-1">
                <p class="font-semibold">You</p>
                <p class="text-gray-300">${message}</p>
            </div>
        `;
        chatBox.appendChild(userMessageEl);

        // TODO: Add logic to send message to backend and receive a response

        // Simulate bot response for demonstration
        setTimeout(() => {
            const botMessageEl = document.createElement("div");
            botMessageEl.className = "flex items-start gap-4";
            botMessageEl.innerHTML = `
                <div class="w-8 h-8 rounded-full bg-gradient-to-br from-blue-400 to-purple-500 flex items-center justify-center">
                    <img src="{% static 'images/vinebotLogo.png' %}" alt="logo" class="w-8 h-8 rounded-full bg-gradient-to-br from-blue-400 to-purple-500 flex items-center justify-center">
                </div>
                <div class="flex-1 pt-1">
                    <p class="font-semibold">VineBot</p>
                    <p class="text-gray-300">This is a simulated response. Connect to your backend for a real answer.</p>
                </div>
            `;
            chatBox.appendChild(botMessageEl);
            chatBox.scrollTop = chatBox.scrollHeight;
        }, 1000);

        // Clear input and reset height
        chatInput.value = "";
        autoGrow(chatInput);
        submitButton.disabled = true;
        chatBox.scrollTop = chatBox.scrollHeight;
    });
</script>
{% endblock %}